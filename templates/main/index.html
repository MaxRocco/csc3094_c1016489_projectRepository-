{% extends "base.html" %}

{% block content %}

    <h1 class="title">Reflective Journals Page</h1>
    <h2 class="subtitle">Explore your journal entries and connections</h2>

    <style>
        #friend-functionality {
            position: absolute;
            top: 0;
            left: 0;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            color: #333;
            width: 300px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>

    <div id="friend-functionality">
        {% if current_user.is_authenticated %}
            <h3>Welcome, {{ current_user.firstname }}!</h3>

            <div>
                <h4>Friend Requests:</h4>
                {% for request in current_user.received_friendships.filter_by(status='pending').all() %}
                    <p>{{ request.requester.firstname }} wants to be your friend</p>
                    <form method="post" action="{{ url_for('users.accept_friend_request', request_id=request.id) }}">
                        <button type="submit">Accept</button>
                    </form>
                    <form method="post" action="{{ url_for('users.decline_friend_request', request_id=request.id) }}">
                        <button type="submit">Decline</button>
                    </form>
                {% else %}
                    <p>You have no pending friend requests</p>
                {% endfor %}
            </div>
            <div>
                <h4>Find Users:</h4>
                <form method="get" action="{{ url_for('users.search_users') }}">
                    <input type="text" name="query" placeholder="Search for friends by email"
                           style="padding: 5px; margin: 5px 0; width: 90%;">
                    <button type="submit">Search</button>
                </form>
            </div>

            {% if search_results %}
                <h4>Search Results: </h4>
                {% for user in search_results %}
                    <p>{{ user.firstname }} {{ user.lastname }} - {{ user.email }}</p>
                    {% if user.id != current_user.id %}
                        <form method="post" action="{{ url_for('users.send_friend_request', user_id=user.id) }}">
                            <button type="submit">Send Friend Request</button>
                        </form>
                    {% endif %}
                {% else %}
                    <p>No users found with this email</p>
                {% endfor %}
            {% endif %}
        {% else %}
            <p>Please log in to view social features </p>
        {% endif %}
    </div>

{% endblock %}
